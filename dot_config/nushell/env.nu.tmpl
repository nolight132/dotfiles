{{ if eq .chezmoi.os "darwin" }}
$env.path = ($env.path | prepend "/opt/homebrew/bin" | prepend "/opt/homebrew/sbin")
{{ end }}

$env.EDITOR = "vim"
$env.VISUAL = "zeditor"
$env.RUSTC_WRAPPER = "sccache"

let extra_paths = [
    $"($env.HOME)/.opencode/bin"
    $"($env.HOME)/.local/bin"
    $"($env.HOME)/.cargo/bin"
{{ if eq .chezmoi.os "darwin" }}
    $"($env.HOME)/.zerobrew/bin"
    "/opt/zerobrew/prefix/bin"
{{ end }}
{{ if (stat "/nix") }}
    $"($env.HOME)/.nix-profile/bin"
    "/nix/var/nix/profiles/default/bin"
    "/run/current-system/sw/bin"
{{ end }}
]

$env.path = ($env.path
    | append ($extra_paths | where { |p| $p | path exists })
    | uniq
)

$env.NIX_PATH = $"nixpkgs=($env.HOME)/.nix-defexpr/channels/nixpkgs"

let cert_paths = [
    "/etc/ssl/certs/ca-certificates.crt"
    "/etc/pki/tls/certs/ca-bundle.crt"
{{ if eq .chezmoi.os "darwin" }}
    "/opt/zerobrew/prefix/etc/ca-certificates/cacert.pem"
    "/opt/zerobrew/prefix/share/ca-certificates/cacert.pem"
{{ end }}
]

let found_cert = ($cert_paths | where { |p| $p | path exists } | first)
if ($found_cert | is-not-empty) {
    $env.NIX_SSL_CERT_FILE = $found_cert
    $env.SSL_CERT_FILE = $found_cert
    $env.CURL_CA_BUNDLE = $found_cert
}
